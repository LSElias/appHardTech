@model Infraestructure.Models.Factura

@{
    ViewBag.Title = "Editar";
}

@functions{
    public string getDateString(DateTime? date)
    {
        DateTime fecha = (DateTime)date;
        return fecha.Day + "/" + fecha.Month + "/" + fecha.Year;
    }

    public double? calcularAcumulado(int? cantidad, double? precio)
    {
        return (cantidad * precio);
    }
}

<h2 class="page-title">Editar</h2>

@using (Html.BeginForm("Save", "Factura", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(model => model.IdFactura)

    <div class="orden-container">
        <div class="orden-header">
            <h4>Factura #@Model.IdFactura</h4>
        </div>

        <div class="dl-horizontal inside-orden">

            <div class="header-inside-orden row">
                <div class="col-md-12">
                    <p> Cliente: @Model.Usuario.Nombre @Model.Usuario.Apellido1 @Model.Usuario.Apellido2</p>
                    <p> Correo: @Model.Usuario.Correo</p>
                </div>

                <div class="col-md-4">
                    <h6>
                        @Html.DisplayNameFor(model => model.Orden.FechaInicio):
                    </h6>

                    <p>
                        @Html.DisplayFor(model => model.Orden.FechaInicio)
                    </p>
                </div>
                <div class="col-md-4">
                    <h6>
                        @Html.DisplayNameFor(model => model.Orden.Estado):
                    </h6>

                    <p style="margin: 0 100px 10px 0 ">
                        @Html.DropDownList("IdEstado", null, htmlAttributes: new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Orden.IdEstado, "", new { @class = "text-danger" })
                    </p>
                </div>
                <div class="col-md-4">
                    <h6>
                        @Html.DisplayNameFor(model => model.CuentaPago.TipoPago):
                    </h6>

                    <p>
                        @Html.DisplayFor(model => model.CuentaPago.TipoPago.Nombre)
                    </p>
                </div>
            </div>

            <table class="table tablaOrden">
                <tr>
                    <th>
                        Nombre
                    </th>
                    <th style="text-align: center;">
                        Cantidad
                    </th>
                    <th style="text-align: center;">
                        Precio
                    </th>
                    <th style="text-align: center;">
                        Precio por volumen
                    </th>
                    <th style="text-align: center;">
                        Estado
                    </th>
                    <th style="text-align: center;">
                        Fecha de entrega
                    </th>
                </tr>

                @foreach (var item in Model.Orden.OrdenDetalle)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.Producto.Nombre)
                        </td>
                        <td style="text-align: center;">
                            @Html.DisplayFor(modelItem => item.Cantidad)
                        </td>
                        <td style="text-align: center;">
                            @Html.DisplayFor(modelItem => item.Producto.Precio)
                        </td>
                        <td style="text-align: center;">
                            ₡@calcularAcumulado(item.Cantidad, item.Producto.Precio)
                        </td>
                        <td style="text-align: center;">
                            @Html.DisplayFor(modelItem => item.Estado.Nombre)
                        </td>
                        <td class="form-group" style="text-align: center;">
                            @Html.EditorFor(modelItem => item.FechaEntrega, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => item.FechaEntrega, "", new { @class = "text-danger" })
                        </td>
                    </tr>
                }

            </table>
            <div class="orden-totales">
                <h6>
                    @Html.DisplayNameFor(model => model.Orden.SubTotal): @Html.DisplayFor(model => model.Orden.SubTotal)
                </h6>
                <h6>
                    @Html.DisplayNameFor(model => model.IVA): @Html.DisplayFor(model => model.IVA)%

                </h6>
                <h6>
                    @Html.DisplayNameFor(model => model.Total): @Html.DisplayFor(model => model.Total)
                </h6>
            </div>
            <hr />
            <div>
                <h5> Otros detalles: </h5>
                <h6>
                    @Html.DisplayNameFor(model => model.Direccion): @Html.DisplayFor(model => model.Direccion.Provincia), @Html.DisplayFor(model => model.Direccion.Canton), @Html.DisplayFor(model => model.Direccion.Distrito), @Html.DisplayFor(model => model.Direccion.DireccionExacta)
                </h6>
            </div>
        </div>

    </div>

    <div class="form-group mb-3" style="margin: 15px 0 15px 20px">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Guardar" readonly class="btn btn-comprar" />
        </div>
    </div>
}

<div class="form-group mb-3" style="margin: 15px 0 15px 20px">
    <a class="page-title" style="text-decoration: none" href="/Factura/MisVentas">Volver</a>
</div>
