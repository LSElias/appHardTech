
@{
    ViewBag.Title = "Mis Evaluaciones";
}



@functions{

    public double promedioCalifsProv(IEnumerable<Infraestructure.Models.Evaluacion> lista)
    {
        double valor = 0;
        int count = 0;

        if(lista is null)
        {
            return 0;
        }

        foreach( Infraestructure.Models.Evaluacion ev in lista) {


                count++;
                valor += (int) ev.Escala.Valor;
        }
        return valor / count;
    }
}


<div class="container-fluid m-auto text-center pt-5">
    <h1 class="page-title">Mis Evaluaciones</h1>
</div>



<script>
    $(document).ready(function () {

        $('#productoGrid').dataTable({
            "processing": true,
            "serverSide": true,
            "filter": false,
            "bFilter": false,
            "orderMulti": false,
            "pageLength": 5,
            "scrollX": true,
            "language": {
                "lengthMenu": "Muestre _MENU_ productos por página",
                "zeroRecords": "No logramos encontrar los productos - Perdón :(",
                "info": "Mostrando página _PAGE_ de _PAGES_",
                "infoEmpty": "No hay productos para mostrar",
                "infoFiltered": "(filtrado de _MAX_ productos totales)",
                "paginate": {
                    "first": "Primera",
                    "last": "Última",
                    "next": "Siguiente",
                    "previous": "Previa"
                },
                "search": "Buscar  "
            },

            "ajax": {
                "url": "/Evaluacion/LoadData",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs":
                [
                    {
                        "targets": [0],
                        "visible": false,
                        "searchable": false
                    },
                    {
                        "targets": [3],
                        "visible": true,
                        "searchable": false,
                        orderable: false,
                    },
                ],

            "columns": [
                { "data": "Id", "name": "Id", "autoWidth": true },
                { "data": "Nombre", "name": "Nombre", "autoWidth": true },
                { "data": "Valor", "name": "Valor", "autoWidth": true },
                {
                    "render": function (data, type, full, meta) {
                        return '<a class="btn Detalle"  onclick="CrearEvaluacion('
                            + full.Id + ')"> <i class="fa-solid fa-circle-info fa-xl"></i> </a>';
                    }
                },
            ]

        });
    });

    function CrearEvaluacion(idEvaluacion) {
        $.ajax({
            method: "POST",
            url: "/Evaluacion/EvaluarProveedor",
            data: { "id": idEvaluacion },
            success: function (result) {
                $(".modal-body").html("");
                $(".modal-body").html(result);
                $("#myModal").modal("show")
            }, error: function (xhr, status, error) {
                console.log("Error: " + error, "No Error: " + xhr.status)
            }
        });
    }

</script>

<div class=" ">
    <br />
    @if (ViewBag.Evaluado.Count != 0)
    {
        <div class="mb-3" style="float:right; color:#dbdbdb">
            Mi promedio:<span style="color:#e0a925"> @promedioCalifsProv(ViewBag.Evaluado) ★</span>
        </div>

    }
    else
    {


    }
    <div style=" width:101%; margin:0 auto;">
        <table id="productoGrid" class="table table-striped table-bordered dt-responsive nowrap overflow-x-scroll" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>Id</th> @* 0 *@
                    <th>Nombre del Evaluado</th> @* 1 *@
                    <th>Valor</th> @* 2 *@
                    <th>Detalle</th> @* 4 *@
                </tr>
            </thead>
        </table>
    </div>

    @* Modal *@
    <input type="hidden" id="campoOculto" />
    <div class="modal" tabindex="-1" id="myModal">
        <div class="modal-dialog modal-lg box-eval" role="document">
            <div class="modal-content">
                <div class="modal-header" style="border: none">
                    <h5 class="head-Title"> Detalle de evaluación </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="background-color: #2222226c; border-radius: 10px; margin: 3px 10px; border: 1px solid #ffffff23">
                    <p>Modal body text goes here.</p>
                </div>
                <div class="modal-footer" style="border:none;">
                    <button type="button" class="btn btn-detalle" data-bs-dismiss="modal">Salir</button>
                </div>
            </div>
        </div>
    </div>
    @* Modal *@

</div>
